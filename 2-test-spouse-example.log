% make test ONLY=test/postgresql/spouse_example.bats
# submodule runner/mkmimo: already built d76a89a10102066b4b0bb40a687c883b2c84809b
# submodule util/mindbender: already built 2589a343830de60af8af0cc78f6b4025b34d88ca
# Running 10 tests defined in 1 .bats files
#  To test selectively, run:  make test   ONLY+=/path/to/bats/files
#  To exclude certain tests:  make test EXCEPT+=/path/to/bats/files
#  For a list of tests, run:  make test-list
test/bats/bin/bats \
  test/postgresql/spouse_example.bats \
  #
 ✓ postgresql spouse example compile/init
 ✓ postgresql spouse example load corpus
 ✗ postgresql spouse example extraction/grounding
   (in test file test/postgresql/spouse_example.bats, line 39)
     `deepdive do model/factorgraph' failed
   'run/RUNNING' -> '20170521/093259.114530806'
   2017-05-21 09:32:59.847179 ################################################################################
   2017-05-21 09:32:59.849008 # Host: ubuntu-1604
   2017-05-21 09:32:59.849064 # DeepDive: deepdive v0.9.0rc2-1063-g7b82f5a (Linux x86_64)
   2017-05-21 09:32:59.849100 export PATH='/home/kongvc/deepdive/dist/stage/bin':"$PATH"
   2017-05-21 09:32:59.849132 export DEEPDIVE_PWD='/home/kongvc/deepdive/test/postgresql/spouse_example'
   2017-05-21 09:32:59.849163 export DEEPDIVE_APP='/home/kongvc/deepdive/test/postgresql/spouse_example'
   2017-05-21 09:32:59.849194 cd "$DEEPDIVE_APP"/run
   2017-05-21 09:32:59.849224 export DEEPDIVE_RUN_ID='20170521/093259.114530806'
   2017-05-21 09:32:59.849255 # Plan: 20170521/093259.114530806/plan.sh
   2017-05-21 09:32:59.849286 # Targets: model/factorgraph
   2017-05-21 09:32:59.849382 ################################################################################
   2017-05-21 09:32:59.849427 
   2017-05-21 09:32:59.849460     # process/init/app/run.sh ####################################### last done: 2017-05-21T09:32:56+00:00 (3s ago
   2017-05-21 09:32:59.849580     # process/init/relation/articles/run.sh ######################### last done: 2017-05-21T09:32:58+00:00 (1s ago
   2017-05-21 09:32:59.849622     # deepdive mark 'done' data/articles ############################ last done: 2017-05-21T09:32:58+00:00 (1s ago
   2017-05-21 09:32:59.849658     # process/ext_sentences_by_nlp_markup/run.sh #################### last done: 2017-05-21T09:32:58+00:00 (1s ago
   2017-05-21 09:32:59.849693     # deepdive mark 'done' data/sentences ########################### last done: 2017-05-21T09:32:58+00:00 (1s ago
   2017-05-21 09:32:59.849727 process/ext_person_mention_by_map_person_mention/run.sh ############# last done: N/A
   2017-05-21 09:32:59.849784 ++ dirname process/ext_person_mention_by_map_person_mention/run.sh
   2017-05-21 09:32:59.849829 + cd process/ext_person_mention_by_map_person_mention
   2017-05-21 09:32:59.849862 + : dd_tmp_ dd_old_
   2017-05-21 09:32:59.849892 + export DEEPDIVE_CURRENT_PROCESS_NAME=process/ext_person_mention_by_map_person_mention
   2017-05-21 09:32:59.849923 + DEEPDIVE_CURRENT_PROCESS_NAME=process/ext_person_mention_by_map_person_mention
   2017-05-21 09:32:59.849953 + export DEEPDIVE_LOAD_FORMAT=tsj
   2017-05-21 09:32:59.849983 + DEEPDIVE_LOAD_FORMAT=tsj
   2017-05-21 09:32:59.850013 + output_relation=person_mention
   2017-05-21 09:32:59.850044 + output_relation_tmp=dd_tmp_person_mention
   2017-05-21 09:32:59.850074 + output_relation_old=dd_old_person_mention
   2017-05-21 09:32:59.850104 + deepdive create table-if-not-exists person_mention
   2017-05-21 09:32:59.968726 + deepdive create table dd_tmp_person_mention like person_mention
   2017-05-21 09:33:00.320969 CREATE TABLE
   2017-05-21 09:33:00.322095 + deepdive compute execute 'input_sql=
   2017-05-21 09:33:00.322143 
   2017-05-21 09:33:00.322156 SELECT R0.doc_id AS column_0
   2017-05-21 09:33:00.322164      , R0.sentence_index AS column_1
   2017-05-21 09:33:00.322172      , R0.tokens AS column_2
   2017-05-21 09:33:00.322181      , R0.ner_tags AS column_3
   2017-05-21 09:33:00.322189 FROM sentences R0
   2017-05-21 09:33:00.322197 
   2017-05-21 09:33:00.322205 ' 'command=cd "$DEEPDIVE_APP" && udf/map_person_mention.py' output_relation=dd_tmp_person_mention
   2017-05-21 09:33:00.428550 Executing with the following configuration:
   2017-05-21 09:33:00.428627  DEEPDIVE_NUM_PROCESSES=1
   2017-05-21 09:33:00.428640  DEEPDIVE_NUM_PARALLEL_UNLOADS=1
   2017-05-21 09:33:00.428648  DEEPDIVE_NUM_PARALLEL_LOADS=1
   2017-05-21 09:33:00.428655  DEEPDIVE_NAMED_PIPES_DIR=/home/kongvc/deepdive/test/postgresql/spouse_example/run/process/ext_person_mention_by_map_person_mention
   2017-05-21 09:33:00.493387 unloading to /home/kongvc/deepdive/test/postgresql/spouse_example/run/process/ext_person_mention_by_map_person_mention/deepdive-compute-execute.802NwO2/feed_processes-1: '
   2017-05-21 09:33:00.493458 
   2017-05-21 09:33:00.493471 SELECT R0.doc_id AS column_0
   2017-05-21 09:33:00.493480      , R0.sentence_index AS column_1
   2017-05-21 09:33:00.493488      , R0.tokens AS column_2
   2017-05-21 09:33:00.493496      , R0.ner_tags AS column_3
   2017-05-21 09:33:00.493504 FROM sentences R0
   2017-05-21 09:33:00.493512 
   2017-05-21 09:33:00.493520 '
   2017-05-21 09:33:00.619135 Traceback (most recent call last):
   2017-05-21 09:33:00.619363   File "/home/kongvc/deepdive/dist/stage/util/db-driver/postgresql/db-query-tsj", line 6, in <module>
   2017-05-21 09:33:00.619423     import psycopg2, psycopg2.extras, ujson
   2017-05-21 09:33:00.619475 ImportError: No module named psycopg2
   2017-05-21 09:33:00.621873 /home/kongvc/deepdive/dist/stage/util/compute-driver/local/compute-execute: line 129: kill: (29337) - No such process
   2017-05-21 09:33:00.623408 [ERROR] deepdive-unload: PID 29337: finished with non-zero exit status (1)
   2017-05-21 09:33:00.627013 /home/kongvc/deepdive/dist/stage/util/compute-driver/local/compute-execute: line 126: 29329 Terminated              DEEPDIVE_CURRENT_PROCESS_INDEX=$i bash -c "$command" < "$pipes"/process-$i.input > "$pipes"/process-$i.output
   2017-05-21 09:33:00.627046 /home/kongvc/deepdive/dist/stage/util/compute-driver/local/compute-execute: line 126: 29332 Terminated              mkmimo "$pipes"/process-*.output \> "$pipes"/output_computed-*
   2017-05-21 09:33:00.627059 /home/kongvc/deepdive/dist/stage/util/compute-driver/local/compute-execute: line 126: 29333 Terminated              deepdive-load "$output_relation" "$pipes"/output_computed-*
   2017-05-21 09:33:00.627067 /home/kongvc/deepdive/dist/stage/util/compute-driver/local/compute-execute: line 126: 29338 Terminated              mkmimo "$pipes"/feed_processes-* \> "$pipes"/process-*.input
   2017-05-21 09:32:59.849727 process/ext_person_mention_by_map_person_mention/run.sh
   'run/ABORTED' -> '20170521/093259.114530806'
 ✗ postgresql spouse example learning/inference/calibration
   (in test file test/postgresql/spouse_example.bats, line 43)
     `deepdive do model/calibration-plots' failed
   'run/RUNNING' -> '20170521/093300.804756279'
   2017-05-21 09:33:01.764671 process/ext_person_mention_by_map_person_mention/run.sh
   2017-05-21 09:33:01.762762 ################################################################################
   2017-05-21 09:33:01.764010 # Host: ubuntu-1604
   2017-05-21 09:33:01.764072 # DeepDive: deepdive v0.9.0rc2-1063-g7b82f5a (Linux x86_64)
   2017-05-21 09:33:01.764111 export PATH='/home/kongvc/deepdive/dist/stage/bin':"$PATH"
   2017-05-21 09:33:01.764143 export DEEPDIVE_PWD='/home/kongvc/deepdive/test/postgresql/spouse_example'
   2017-05-21 09:33:01.764174 export DEEPDIVE_APP='/home/kongvc/deepdive/test/postgresql/spouse_example'
   2017-05-21 09:33:01.764204 cd "$DEEPDIVE_APP"/run
   2017-05-21 09:33:01.764234 export DEEPDIVE_RUN_ID='20170521/093300.804756279'
   2017-05-21 09:33:01.764265 # Plan: 20170521/093300.804756279/plan.sh
   2017-05-21 09:33:01.764295 # Targets: model/calibration-plots
   2017-05-21 09:33:01.764324 ################################################################################
   2017-05-21 09:33:01.764355 
   2017-05-21 09:33:01.764385     # process/init/app/run.sh ####################################### last done: 2017-05-21T09:32:56+00:00 (4s ago
   2017-05-21 09:33:01.764525     # process/init/relation/articles/run.sh ######################### last done: 2017-05-21T09:32:58+00:00 (2s ago
   2017-05-21 09:33:01.764569     # deepdive mark 'done' data/articles ############################ last done: 2017-05-21T09:32:58+00:00 (2s ago
   2017-05-21 09:33:01.764604     # process/ext_sentences_by_nlp_markup/run.sh #################### last done: 2017-05-21T09:32:58+00:00 (2s ago
   2017-05-21 09:33:01.764637     # deepdive mark 'done' data/sentences ########################### last done: 2017-05-21T09:32:58+00:00 (2s ago
   2017-05-21 09:33:01.764671 process/ext_person_mention_by_map_person_mention/run.sh ############# last done: N/A
   2017-05-21 09:33:01.764725 ++ dirname process/ext_person_mention_by_map_person_mention/run.sh
   2017-05-21 09:33:01.764762 + cd process/ext_person_mention_by_map_person_mention
   2017-05-21 09:33:01.764793 + : dd_tmp_ dd_old_
   2017-05-21 09:33:01.764824 + export DEEPDIVE_CURRENT_PROCESS_NAME=process/ext_person_mention_by_map_person_mention
   2017-05-21 09:33:01.764854 + DEEPDIVE_CURRENT_PROCESS_NAME=process/ext_person_mention_by_map_person_mention
   2017-05-21 09:33:01.764884 + export DEEPDIVE_LOAD_FORMAT=tsj
   2017-05-21 09:33:01.764915 + DEEPDIVE_LOAD_FORMAT=tsj
   2017-05-21 09:33:01.764945 + output_relation=person_mention
   2017-05-21 09:33:01.764976 + output_relation_tmp=dd_tmp_person_mention
   2017-05-21 09:33:01.765006 + output_relation_old=dd_old_person_mention
   2017-05-21 09:33:01.765045 + deepdive create table-if-not-exists person_mention
   2017-05-21 09:33:01.881517 + deepdive create table dd_tmp_person_mention like person_mention
   2017-05-21 09:33:02.242493 CREATE TABLE
   2017-05-21 09:33:02.243620 + deepdive compute execute 'input_sql=
   2017-05-21 09:33:02.243670 
   2017-05-21 09:33:02.243681 SELECT R0.doc_id AS column_0
   2017-05-21 09:33:02.243690      , R0.sentence_index AS column_1
   2017-05-21 09:33:02.243697      , R0.tokens AS column_2
   2017-05-21 09:33:02.243705      , R0.ner_tags AS column_3
   2017-05-21 09:33:02.243713 FROM sentences R0
   2017-05-21 09:33:02.243721 
   2017-05-21 09:33:02.243729 ' 'command=cd "$DEEPDIVE_APP" && udf/map_person_mention.py' output_relation=dd_tmp_person_mention
   2017-05-21 09:33:02.347749 Executing with the following configuration:
   2017-05-21 09:33:02.347815  DEEPDIVE_NUM_PROCESSES=1
   2017-05-21 09:33:02.347828  DEEPDIVE_NUM_PARALLEL_UNLOADS=1
   2017-05-21 09:33:02.347836  DEEPDIVE_NUM_PARALLEL_LOADS=1
   2017-05-21 09:33:02.347844  DEEPDIVE_NAMED_PIPES_DIR=/home/kongvc/deepdive/test/postgresql/spouse_example/run/process/ext_person_mention_by_map_person_mention
   2017-05-21 09:33:02.409400 unloading to /home/kongvc/deepdive/test/postgresql/spouse_example/run/process/ext_person_mention_by_map_person_mention/deepdive-compute-execute.coHjnze/feed_processes-1: '
   2017-05-21 09:33:02.409478 
   2017-05-21 09:33:02.409492 SELECT R0.doc_id AS column_0
   2017-05-21 09:33:02.409500      , R0.sentence_index AS column_1
   2017-05-21 09:33:02.409507      , R0.tokens AS column_2
   2017-05-21 09:33:02.409515      , R0.ner_tags AS column_3
   2017-05-21 09:33:02.409522 FROM sentences R0
   2017-05-21 09:33:02.409530 
   2017-05-21 09:33:02.409537 '
   2017-05-21 09:33:02.546393 Traceback (most recent call last):
   2017-05-21 09:33:02.546517   File "/home/kongvc/deepdive/dist/stage/util/db-driver/postgresql/db-query-tsj", line 6, in <module>
   2017-05-21 09:33:02.546565     import psycopg2, psycopg2.extras, ujson
   2017-05-21 09:33:02.546616 ImportError: No module named psycopg2
   2017-05-21 09:33:02.550877 /home/kongvc/deepdive/dist/stage/util/compute-driver/local/compute-execute: line 129: kill: (30901) - No such process
   2017-05-21 09:33:02.555414 [ERROR] deepdive-unload: PID 30901: finished with non-zero exit status (1)
   2017-05-21 09:33:02.557025 /home/kongvc/deepdive/dist/stage/util/compute-driver/local/compute-execute: line 126: 30893 Terminated              DEEPDIVE_CURRENT_PROCESS_INDEX=$i bash -c "$command" < "$pipes"/process-$i.input > "$pipes"/process-$i.output
   2017-05-21 09:33:02.557059 /home/kongvc/deepdive/dist/stage/util/compute-driver/local/compute-execute: line 126: 30896 Terminated              mkmimo "$pipes"/process-*.output \> "$pipes"/output_computed-*
   2017-05-21 09:33:02.557071 /home/kongvc/deepdive/dist/stage/util/compute-driver/local/compute-execute: line 126: 30897 Terminated              deepdive-load "$output_relation" "$pipes"/output_computed-*
   2017-05-21 09:33:02.557080 /home/kongvc/deepdive/dist/stage/util/compute-driver/local/compute-execute: line 126: 30902 Terminated              mkmimo "$pipes"/feed_processes-* \> "$pipes"/process-*.input
   'run/ABORTED' -> '20170521/093300.804756279'
 - postgresql spouse example gives good quality (skipped: accuracy= < 90)
 ✓ postgresql spouse example keep weights
 ✓ postgresql spouse example load larger corpus
 ✗ postgresql spouse example reuse weights
   (in test file test/postgresql/spouse_example.bats, line 68)
     `deepdive model weights reuse  # taking care of all extraction and grounding for larger data' failed
   CREATE TABLE
   /home/kongvc/deepdive/dist/stage/util/deepdive-model: line 150: snapshot/model/weights/LAST/dd_weights.metadata: No such file or directory
 ✗ postgresql spouse example skips learning
   (in test file test/postgresql/spouse_example.bats, line 72)
     `deepdive model infer' failed
   'run/RUNNING' -> '20170521/093307.861557770'
   2017-05-21 09:33:08.699619 process/ext_person_mention_by_map_person_mention/run.sh
   2017-05-21 09:33:08.698821 ################################################################################
   2017-05-21 09:33:08.699013 # Host: ubuntu-1604
   2017-05-21 09:33:08.699058 # DeepDive: deepdive v0.9.0rc2-1063-g7b82f5a (Linux x86_64)
   2017-05-21 09:33:08.699091 export PATH='/home/kongvc/deepdive/dist/stage/bin':"$PATH"
   2017-05-21 09:33:08.699122 export DEEPDIVE_PWD='/home/kongvc/deepdive/test/postgresql/spouse_example'
   2017-05-21 09:33:08.699152 export DEEPDIVE_APP='/home/kongvc/deepdive/test/postgresql/spouse_example'
   2017-05-21 09:33:08.699183 cd "$DEEPDIVE_APP"/run
   2017-05-21 09:33:08.699213 export DEEPDIVE_RUN_ID='20170521/093307.861557770'
   2017-05-21 09:33:08.699243 # Plan: 20170521/093307.861557770/plan.sh
   2017-05-21 09:33:08.699273 # Targets: process/model/inference data/model/weights data/model/probabilities
   2017-05-21 09:33:08.699303 ################################################################################
   2017-05-21 09:33:08.699333 
   2017-05-21 09:33:08.699363     # process/init/app/run.sh ####################################### last done: 2017-05-21T09:32:56+00:00 (11s ago
   2017-05-21 09:33:08.699480     # process/init/relation/articles/run.sh ######################### last done: 2017-05-21T09:32:58+00:00 (9s ago
   2017-05-21 09:33:08.699518     # deepdive mark 'done' data/articles ############################ last done: 2017-05-21T09:32:58+00:00 (9s ago
   2017-05-21 09:33:08.699552     # process/ext_sentences_by_nlp_markup/run.sh #################### last done: 2017-05-21T09:32:58+00:00 (9s ago
   2017-05-21 09:33:08.699585     # deepdive mark 'done' data/sentences ########################### last done: 2017-05-21T09:33:07+00:00 (just now
   2017-05-21 09:33:08.699619 process/ext_person_mention_by_map_person_mention/run.sh ############# last done: N/A
   2017-05-21 09:33:08.699681 ++ dirname process/ext_person_mention_by_map_person_mention/run.sh
   2017-05-21 09:33:08.699719 + cd process/ext_person_mention_by_map_person_mention
   2017-05-21 09:33:08.699750 + : dd_tmp_ dd_old_
   2017-05-21 09:33:08.699780 + export DEEPDIVE_CURRENT_PROCESS_NAME=process/ext_person_mention_by_map_person_mention
   2017-05-21 09:33:08.699810 + DEEPDIVE_CURRENT_PROCESS_NAME=process/ext_person_mention_by_map_person_mention
   2017-05-21 09:33:08.699840 + export DEEPDIVE_LOAD_FORMAT=tsj
   2017-05-21 09:33:08.699869 + DEEPDIVE_LOAD_FORMAT=tsj
   2017-05-21 09:33:08.699900 + output_relation=person_mention
   2017-05-21 09:33:08.699929 + output_relation_tmp=dd_tmp_person_mention
   2017-05-21 09:33:08.699959 + output_relation_old=dd_old_person_mention
   2017-05-21 09:33:08.699989 + deepdive create table-if-not-exists person_mention
   2017-05-21 09:33:08.814456 + deepdive create table dd_tmp_person_mention like person_mention
   2017-05-21 09:33:09.156123 CREATE TABLE
   2017-05-21 09:33:09.157221 + deepdive compute execute 'input_sql=
   2017-05-21 09:33:09.157270 
   2017-05-21 09:33:09.157281 SELECT R0.doc_id AS column_0
   2017-05-21 09:33:09.157289      , R0.sentence_index AS column_1
   2017-05-21 09:33:09.157297      , R0.tokens AS column_2
   2017-05-21 09:33:09.157305      , R0.ner_tags AS column_3
   2017-05-21 09:33:09.157312 FROM sentences R0
   2017-05-21 09:33:09.157320 
   2017-05-21 09:33:09.158570 ' 'command=cd "$DEEPDIVE_APP" && udf/map_person_mention.py' output_relation=dd_tmp_person_mention
   2017-05-21 09:33:09.263757 Executing with the following configuration:
   2017-05-21 09:33:09.263836  DEEPDIVE_NUM_PROCESSES=1
   2017-05-21 09:33:09.263849  DEEPDIVE_NUM_PARALLEL_UNLOADS=1
   2017-05-21 09:33:09.263858  DEEPDIVE_NUM_PARALLEL_LOADS=1
   2017-05-21 09:33:09.263866  DEEPDIVE_NAMED_PIPES_DIR=/home/kongvc/deepdive/test/postgresql/spouse_example/run/process/ext_person_mention_by_map_person_mention
   2017-05-21 09:33:09.325390 unloading to /home/kongvc/deepdive/test/postgresql/spouse_example/run/process/ext_person_mention_by_map_person_mention/deepdive-compute-execute.QXSSklc/feed_processes-1: '
   2017-05-21 09:33:09.325469 
   2017-05-21 09:33:09.325481 SELECT R0.doc_id AS column_0
   2017-05-21 09:33:09.325489      , R0.sentence_index AS column_1
   2017-05-21 09:33:09.325497      , R0.tokens AS column_2
   2017-05-21 09:33:09.325505      , R0.ner_tags AS column_3
   2017-05-21 09:33:09.325512 FROM sentences R0
   2017-05-21 09:33:09.325520 
   2017-05-21 09:33:09.325528 '
   2017-05-21 09:33:09.460469 Traceback (most recent call last):
   2017-05-21 09:33:09.460606   File "/home/kongvc/deepdive/dist/stage/util/db-driver/postgresql/db-query-tsj", line 6, in <module>
   2017-05-21 09:33:09.460658     import psycopg2, psycopg2.extras, ujson
   2017-05-21 09:33:09.460720 ImportError: No module named psycopg2
   2017-05-21 09:33:09.464990 /home/kongvc/deepdive/dist/stage/util/compute-driver/local/compute-execute: line 129: kill: (1279) - No such process
   2017-05-21 09:33:09.466478 [ERROR] deepdive-unload: PID 1279: finished with non-zero exit status (1)
   2017-05-21 09:33:09.471273 /home/kongvc/deepdive/dist/stage/util/compute-driver/local/compute-execute: line 126:  1270 Terminated              DEEPDIVE_CURRENT_PROCESS_INDEX=$i bash -c "$command" < "$pipes"/process-$i.input > "$pipes"/process-$i.output
   2017-05-21 09:33:09.471312 /home/kongvc/deepdive/dist/stage/util/compute-driver/local/compute-execute: line 126:  1273 Terminated              mkmimo "$pipes"/process-*.output \> "$pipes"/output_computed-*
   2017-05-21 09:33:09.471324 /home/kongvc/deepdive/dist/stage/util/compute-driver/local/compute-execute: line 126:  1274 Terminated              deepdive-load "$output_relation" "$pipes"/output_computed-*
   2017-05-21 09:33:09.471332 /home/kongvc/deepdive/dist/stage/util/compute-driver/local/compute-execute: line 126:  1280 Terminated              mkmimo "$pipes"/feed_processes-* \> "$pipes"/process-*.input
   'run/ABORTED' -> '20170521/093307.861557770'
 - postgresql spouse example generalizes well (skipped: accuracy= < 90)

10 tests, 4 failures, 2 skipped
test/bats.mk:39: recipe for target 'test' failed
make: *** [test] Error 1